"use strict";function _isPlaceholder(r){return null!=r&&"object"==typeof r&&!0===r["@@functional/placeholder"]}function _curry1(r){return function t(e){return 0===arguments.length||_isPlaceholder(e)?t:r.apply(this,arguments)}}function _curry2(r){return function t(e,n){switch(arguments.length){case 0:return t;case 1:return _isPlaceholder(e)?t:_curry1(function(t){return r(e,t)});default:return _isPlaceholder(e)&&_isPlaceholder(n)?t:_isPlaceholder(e)?_curry1(function(t){return r(t,n)}):_isPlaceholder(n)?_curry1(function(t){return r(e,t)}):r(e,n)}}}function _concat(r,t){r=r||[],t=t||[];var e,n=r.length,u=t.length,i=[];for(e=0;e<n;)i[i.length]=r[e],e+=1;for(e=0;e<u;)i[i.length]=t[e],e+=1;return i}function _arity(r,t){switch(r){case 0:return function(){return t.apply(this,arguments)};case 1:return function(r){return t.apply(this,arguments)};case 2:return function(r,e){return t.apply(this,arguments)};case 3:return function(r,e,n){return t.apply(this,arguments)};case 4:return function(r,e,n,u){return t.apply(this,arguments)};case 5:return function(r,e,n,u,i){return t.apply(this,arguments)};case 6:return function(r,e,n,u,i,o){return t.apply(this,arguments)};case 7:return function(r,e,n,u,i,o,a){return t.apply(this,arguments)};case 8:return function(r,e,n,u,i,o,a,c){return t.apply(this,arguments)};case 9:return function(r,e,n,u,i,o,a,c,l){return t.apply(this,arguments)};case 10:return function(r,e,n,u,i,o,a,c,l,s){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function _curryN(r,t,e){return function(){for(var n=arguments,u=[],i=0,o=r,a=0;a<t.length||i<arguments.length;){var c;a<t.length&&(!_isPlaceholder(t[a])||i>=n.length)?c=t[a]:(c=n[i],i+=1),u[a]=c,_isPlaceholder(c)||(o-=1),a+=1}return o<=0?e.apply(this,u):_arity(o,_curryN(r,u,e))}}function _curry3(r){return function t(e,n,u){switch(arguments.length){case 0:return t;case 1:return _isPlaceholder(e)?t:_curry2(function(t,n){return r(e,t,n)});case 2:return _isPlaceholder(e)&&_isPlaceholder(n)?t:_isPlaceholder(e)?_curry2(function(t,e){return r(t,n,e)}):_isPlaceholder(n)?_curry2(function(t,n){return r(e,t,n)}):_curry1(function(t){return r(e,n,t)});default:return _isPlaceholder(e)&&_isPlaceholder(n)&&_isPlaceholder(u)?t:_isPlaceholder(e)&&_isPlaceholder(n)?_curry2(function(t,e){return r(t,e,u)}):_isPlaceholder(e)&&_isPlaceholder(u)?_curry2(function(t,e){return r(t,n,e)}):_isPlaceholder(n)&&_isPlaceholder(u)?_curry2(function(t,n){return r(e,t,n)}):_isPlaceholder(e)?_curry1(function(t){return r(t,n,u)}):_isPlaceholder(n)?_curry1(function(t){return r(e,t,u)}):_isPlaceholder(u)?_curry1(function(t){return r(e,n,t)}):r(e,n,u)}}}function _isTransformer(r){return"function"==typeof r["@@transducer/step"]}function _dispatchable(r,t,e){return function(){if(0===arguments.length)return e();var n=Array.prototype.slice.call(arguments,0),u=n.pop();if(!_isArray(u)){for(var i=0;i<r.length;){if("function"==typeof u[r[i]])return u[r[i]].apply(u,n);i+=1}if(_isTransformer(u)){return t.apply(null,n)(u)}}return e.apply(this,arguments)}}function _map(r,t){for(var e=0,n=t.length,u=Array(n);e<n;)u[e]=r(t[e]),e+=1;return u}function _isString(r){return"[object String]"===Object.prototype.toString.call(r)}function _xwrap(r){return new XWrap(r)}function _arrayReduce(r,t,e){for(var n=0,u=e.length;n<u;){if((t=r["@@transducer/step"](t,e[n]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}n+=1}return r["@@transducer/result"](t)}function _iterableReduce(r,t,e){for(var n=e.next();!n.done;){if((t=r["@@transducer/step"](t,n.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}n=e.next()}return r["@@transducer/result"](t)}function _methodReduce(r,t,e,n){return r["@@transducer/result"](e[n](bind(r["@@transducer/step"],r),t))}function _reduce(r,t,e){if("function"==typeof r&&(r=_xwrap(r)),_isArrayLike(e))return _arrayReduce(r,t,e);if("function"==typeof e["fantasy-land/reduce"])return _methodReduce(r,t,e,"fantasy-land/reduce");if(null!=e[symIterator])return _iterableReduce(r,t,e[symIterator]());if("function"==typeof e.next)return _iterableReduce(r,t,e);if("function"==typeof e.reduce)return _methodReduce(r,t,e,"reduce");throw new TypeError("reduce: list must be array or iterable")}function _has(r,t){return Object.prototype.hasOwnProperty.call(t,r)}function _isFunction(r){return"[object Function]"===Object.prototype.toString.call(r)}function _makeFlat(r){return function t(e){for(var n,u,i,o=[],a=0,c=e.length;a<c;){if(_isArrayLike(e[a]))for(i=0,u=(n=r?t(e[a]):e[a]).length;i<u;)o[o.length]=n[i],i+=1;else o[o.length]=e[a];a+=1}return o}}function _forceReduced(r){return{"@@transducer/value":r,"@@transducer/reduced":!0}}function _cloneRegExp(r){return new RegExp(r.source,(r.global?"g":"")+(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.sticky?"y":"")+(r.unicode?"u":""))}function _clone(r,t,e,n){var u=function(u){for(var i=t.length,o=0;o<i;){if(r===t[o])return e[o];o+=1}t[o+1]=r,e[o+1]=u;for(var a in r)u[a]=n?_clone(r[a],t,e,!0):r[a];return u};switch(type(r)){case"Object":return u({});case"Array":return u([]);case"Date":return new Date(r.valueOf());case"RegExp":return _cloneRegExp(r);default:return r}}function _pipe(r,t){return function(){return t.call(this,r.apply(this,arguments))}}function _checkForMethod(r,t){return function(){var e=arguments.length;if(0===e)return t();var n=arguments[e-1];return _isArray(n)||"function"!=typeof n[r]?t.apply(this,arguments):n[r].apply(n,Array.prototype.slice.call(arguments,0,e-1))}}function pipe(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return _arity(arguments[0].length,reduce(_pipe,arguments[0],tail(arguments)))}function compose(){if(0===arguments.length)throw new Error("compose requires at least one argument");return pipe.apply(this,reverse(arguments))}function _arrayFromIterator(r){for(var t,e=[];!(t=r.next()).done;)e.push(t.value);return e}function _containsWith(r,t,e){for(var n=0,u=e.length;n<u;){if(r(t,e[n]))return!0;n+=1}return!1}function _functionName(r){var t=String(r).match(/^function (\w*)/);return null==t?"":t[1]}function _uniqContentEquals(r,t,e,n){function u(r,t){return _equals(r,t,e.slice(),n.slice())}var i=_arrayFromIterator(r);return!_containsWith(function(r,t){return!_containsWith(u,t,r)},_arrayFromIterator(t),i)}function _equals(r,t,e,n){if(identical(r,t))return!0;var u=type(r);if(u!==type(t))return!1;if(null==r||null==t)return!1;if("function"==typeof r["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof r["fantasy-land/equals"]&&r["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](r);if("function"==typeof r.equals||"function"==typeof t.equals)return"function"==typeof r.equals&&r.equals(t)&&"function"==typeof t.equals&&t.equals(r);switch(u){case"Arguments":case"Array":case"Object":if("function"==typeof r.constructor&&"Promise"===_functionName(r.constructor))return r===t;break;case"Boolean":case"Number":case"String":if(typeof r!=typeof t||!identical(r.valueOf(),t.valueOf()))return!1;break;case"Date":if(!identical(r.valueOf(),t.valueOf()))return!1;break;case"Error":return r.name===t.name&&r.message===t.message;case"RegExp":if(r.source!==t.source||r.global!==t.global||r.ignoreCase!==t.ignoreCase||r.multiline!==t.multiline||r.sticky!==t.sticky||r.unicode!==t.unicode)return!1}for(var i=e.length-1;i>=0;){if(e[i]===r)return n[i]===t;i-=1}switch(u){case"Map":return r.size===t.size&&_uniqContentEquals(r.entries(),t.entries(),e.concat([r]),n.concat([t]));case"Set":return r.size===t.size&&_uniqContentEquals(r.values(),t.values(),e.concat([r]),n.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var o=keys(r);if(o.length!==keys(t).length)return!1;var a=e.concat([r]),c=n.concat([t]);for(i=o.length-1;i>=0;){var l=o[i];if(!_has(l,t)||!_equals(t[l],r[l],a,c))return!1;i-=1}return!0}function _indexOf(r,t,e){var n,u;if("function"==typeof r.indexOf)switch(typeof t){case"number":if(0===t){for(n=1/t;e<r.length;){if(0===(u=r[e])&&1/u===n)return e;e+=1}return-1}if(t!=t){for(;e<r.length;){if("number"==typeof(u=r[e])&&u!=u)return e;e+=1}return-1}return r.indexOf(t,e);case"string":case"boolean":case"function":case"undefined":return r.indexOf(t,e);case"object":if(null===t)return r.indexOf(t,e)}for(;e<r.length;){if(equals(r[e],t))return e;e+=1}return-1}function _contains(r,t){return _indexOf(t,r,0)>=0}function _quote(r){return'"'+r.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0").replace(/"/g,'\\"')+'"'}function _complement(r){return function(){return!r.apply(this,arguments)}}function _filter(r,t){for(var e=0,n=t.length,u=[];e<n;)r(t[e])&&(u[u.length]=t[e]),e+=1;return u}function _isObject(r){return"[object Object]"===Object.prototype.toString.call(r)}function _toString(r,t){var e=function(e){var n=t.concat([r]);return _contains(e,n)?"<Circular>":_toString(e,n)},n=function(r,t){return _map(function(t){return _quote(t)+": "+e(r[t])},t.slice().sort())};switch(Object.prototype.toString.call(r)){case"[object Arguments]":return"(function() { return arguments; }("+_map(e,r).join(", ")+"))";case"[object Array]":return"["+_map(e,r).concat(n(r,reject(function(r){return/^\d+$/.test(r)},keys(r)))).join(", ")+"]";case"[object Boolean]":return"object"==typeof r?"new Boolean("+e(r.valueOf())+")":r.toString();case"[object Date]":return"new Date("+(isNaN(r.valueOf())?e(NaN):_quote(_toISOString(r)))+")";case"[object Null]":return"null";case"[object Number]":return"object"==typeof r?"new Number("+e(r.valueOf())+")":1/r==-1/0?"-0":r.toString(10);case"[object String]":return"object"==typeof r?"new String("+e(r.valueOf())+")":_quote(r);case"[object Undefined]":return"undefined";default:if("function"==typeof r.toString){var u=r.toString();if("[object Object]"!==u)return u}return"{"+n(r,keys(r)).join(", ")+"}"}}function _identity(r){return r}function hasOrAdd(r,t,e){var n,u=typeof r;switch(u){case"string":case"number":return 0===r&&1/r==-1/0?!!e._items["-0"]||(t&&(e._items["-0"]=!0),!1):null!==e._nativeSet?t?(n=e._nativeSet.size,e._nativeSet.add(r),e._nativeSet.size===n):e._nativeSet.has(r):u in e._items?r in e._items[u]||(t&&(e._items[u][r]=!0),!1):(t&&(e._items[u]={},e._items[u][r]=!0),!1);case"boolean":if(u in e._items){var i=r?1:0;return!!e._items[u][i]||(t&&(e._items[u][i]=!0),!1)}return t&&(e._items[u]=r?[!1,!0]:[!0,!1]),!1;case"function":return null!==e._nativeSet?t?(n=e._nativeSet.size,e._nativeSet.add(r),e._nativeSet.size===n):e._nativeSet.has(r):u in e._items?!!_contains(r,e._items[u])||(t&&e._items[u].push(r),!1):(t&&(e._items[u]=[r]),!1);case"undefined":return!!e._items[u]||(t&&(e._items[u]=!0),!1);case"object":if(null===r)return!!e._items.null||(t&&(e._items.null=!0),!1);default:return(u=Object.prototype.toString.call(r))in e._items?!!_contains(r,e._items[u])||(t&&e._items[u].push(r),!1):(t&&(e._items[u]=[r]),!1)}}function _isNumber(r){return"[object Number]"===Object.prototype.toString.call(r)}function _createPartialApplicator(r){return _curry2(function(t,e){return _arity(Math.max(0,t.length-e.length),function(){return t.apply(this,r(e,arguments))})})}function doArrayWalk(r,t,e,n){return!!Array.isArray(t)&&!!(e||n&&n.includes(r))}function getPath(r,t){return void 0===r&&(r="array"),{_path:t||("array"===r?[]:""),set:function(t,e){var n;switch(r){case"array":n=this._path.concat([e]);break;case"nestedProperty":n=0===this._path.length?e:Array.isArray(t)?this._path+"["+e+"]":this._path+"."+e;break;default:throw new Error("unrecognized pathType "+r)}return getPath(r,n)},get:function(t,e){return"array"===r?this._path:this.set(t,e)._path}}}function makeAttrSetterPath(r){var t="",e=0;"_fullData"===r[e]&&(e+=2),"_fullInput"===r[e]&&e++,"_fullLayout"===r[e]&&e++;for(var n=e;n<r.length;n++)"number"==typeof r[n]||Array.isArray(r[n])?t+="["+(Array.isArray(r[n])?r[n][0]:r[n])+"]":t+=(n>e?".":"")+r[n];return t}function _walkObject(r,t,e,n){var u=n.walkArrays,i=n.walkArraysMatchingKeys;Object.keys(r).forEach(function(o){if(!t(o,r,e.get(r,o))){var a=r[o];(isPlainObj(a)||doArrayWalk(o,a,u,i))&&_walkObject(a,t,e.set(r,o),n)}})}function walkObject(r,t,e){if(void 0===e&&(e={}),!isPlainObj(r)&&!Array.isArray(r))throw new Error("The input must be an object.");_walkObject(r,t,getPath(e.pathType),e)}function createCommonjsModule(r,t){return t={exports:{}},r(t,t.exports),t.exports}function allBlankCharCodes(r){for(var t,e=r.length,n=0;n<e;n++)if(((t=r.charCodeAt(n))<9||t>13)&&32!==t&&133!==t&&160!==t&&5760!==t&&6158!==t&&(t<8192||t>8205)&&8232!==t&&8233!==t&&8239!==t&&8287!==t&&8288!==t&&12288!==t&&65279!==t)return!1;return!0}function getEventPoints(r,t,e){var n=t.constrained&&"pie"===r._fullData[0].type?null:e;return"pie"===r._fullData[0].type?n?n.points:[]:("histogram"===r._fullData[0].type&&(n={points:[]},e&&!Array.isArray(e)&&e.points.forEach(function(t){(t.pointNumbers||r.calcdata[0][t.pointNumber].pts).forEach(function(r){n.points.push({pointNumber:r,curveNumber:t.curveNumber,data:t.data,fullData:t.fullData})})})),n?n.points.filter(function(t){return t.curveNumber<r._cfData.originalData.length&&t.data.uid===r.data[t.curveNumber].uid}):[])}function toggleContextHover(r,t,e,n){var u=n?"none":t._cfData.originalFullData[e].hoverinfo;u&&t._fullData[e].hoverinfo!==u&&-1===["scattermapbox","scattergeo","scatter3d"].indexOf(t._fullData[0].type)&&r.restyle(t,"hoverinfo",u,[e])}function dimTracePostStyle(r,t,e,n,u){var i=r.d3.select(t);switch(n.type){case"choropleth":toggleContextHover(r,t,u,e);var o=t._cfData.originalOpacity[u];return i.selectAll(".trace path").style("opacity",1),i.selectAll(".trace").filter(function(r,t){return t===u}).style("opacity",e?0:o),i.selectAll(".colorbar .cbaxis").style("opacity",0),void window.setTimeout(function(){i.selectAll(".colorbar .cbaxis").style("opacity",function(r,t){return t===u&&e?0:null})});case"scatter":case"box":toggleContextHover(r,t,u,e);var a=t._cfData.originalOpacity[u];return void i.selectAll(".trace").filter(function(r,t){return t===u}).style("opacity",e?DESELECTDIM:a);case"bar":if(toggleContextHover(r,t,u,e),"stack"===t.layout.barmode)r.restyle(t,"visible",!e,range(0,t._cfData.originalData.length));else{var c=t._cfData.originalOpacity[u];i.selectAll(".trace").filter(function(r,t){return t===u}).style("opacity",e?DESELECTDIM:c)}return;case"histogram":var l=t._cfData.originalOpacity[u];return void i.selectAll(".trace").filter(function(r,t){return t===u}).style("opacity",e?0:l);case"table":return void i.select(".table").style("opacity",e?0:null);case"pie":return i.select(".trace").style("opacity",e?0:null),void i.selectAll(".hovertext").remove();case"scattermapbox":return void r.restyle(t,"marker.opacity",e?DESELECTDIM_MAPBOX:1,[u]);case"scatter3d":return void r.restyle(t,"marker.opacity",e?DESELECTDIM:t._cfData.originalFullData[u].marker.opacity,[u]);default:return void r.d3.select(t).select(".trace").style("opacity",e?DESELECTDIM:null)}}Object.defineProperty(exports,"__esModule",{value:!0});var always=_curry1(function(r){return function(){return r}}),F=always(!1),T=always(!0),add=_curry2(function(r,t){return Number(r)+Number(t)}),curryN=_curry2(function(r,t){return 1===r?_curry1(t):_arity(r,_curryN(r,[],t))}),_isArray=Array.isArray||function(r){return null!=r&&r.length>=0&&"[object Array]"===Object.prototype.toString.call(r)},_xfBase={init:function(){return this.xf["@@transducer/init"]()},result:function(r){return this.xf["@@transducer/result"](r)}},max=_curry2(function(r,t){return t>r?t:r}),_isArrayLike=_curry1(function(r){return!!_isArray(r)||!!r&&("object"==typeof r&&(!_isString(r)&&(1===r.nodeType?!!r.length:0===r.length||r.length>0&&(r.hasOwnProperty(0)&&r.hasOwnProperty(r.length-1)))))}),XWrap=function(){function r(r){this.f=r}return r.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},r.prototype["@@transducer/result"]=function(r){return r},r.prototype["@@transducer/step"]=function(r,t){return this.f(r,t)},r}(),bind=_curry2(function(r,t){return _arity(r.length,function(){return r.apply(t,arguments)})}),symIterator="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",XMap=function(){function r(r,t){this.xf=t,this.f=r}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=_xfBase.result,r.prototype["@@transducer/step"]=function(r,t){return this.xf["@@transducer/step"](r,this.f(t))},r}(),_xmap=_curry2(function(r,t){return new XMap(r,t)}),toString=Object.prototype.toString,_isArguments=function(){return"[object Arguments]"===toString.call(arguments)?function(r){return"[object Arguments]"===toString.call(r)}:function(r){return _has("callee",r)}},hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],hasArgsEnumBug=function(){return arguments.propertyIsEnumerable("length")}(),contains=function(r,t){for(var e=0;e<r.length;){if(r[e]===t)return!0;e+=1}return!1},_keys="function"!=typeof Object.keys||hasArgsEnumBug?function(r){if(Object(r)!==r)return[];var t,e,n=[],u=hasArgsEnumBug&&_isArguments(r);for(t in r)!_has(t,r)||u&&"length"===t||(n[n.length]=t);if(hasEnumBug)for(e=nonEnumerableProps.length-1;e>=0;)_has(t=nonEnumerableProps[e],r)&&!contains(n,t)&&(n[n.length]=t),e-=1;return n}:function(r){return Object(r)!==r?[]:Object.keys(r)},keys=_curry1(_keys),map=_curry2(_dispatchable(["fantasy-land/map","map"],_xmap,function(r,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return curryN(t.length,function(){return r.call(this,t.apply(this,arguments))});case"[object Object]":return _reduce(function(e,n){return e[n]=r(t[n]),e},{},keys(t));default:return _map(r,t)}})),path=_curry2(function(r,t){for(var e=t,n=0;n<r.length;){if(null==e)return;e=e[r[n]],n+=1}return e}),prop=_curry2(function(r,t){return path([r],t)}),pluck=_curry2(function(r,t){return map(prop(r),t)}),reduce=_curry3(_reduce),ap=_curry2(function(r,t){return"function"==typeof t["fantasy-land/ap"]?t["fantasy-land/ap"](r):"function"==typeof r.ap?r.ap(t):"function"==typeof r?function(e){return r(e)(t(e))}:_reduce(function(r,e){return _concat(r,map(e,t))},[],r)}),values=_curry1(function(r){for(var t=keys(r),e=t.length,n=[],u=0;u<e;)n[u]=r[t[u]],u+=1;return n}),liftN=_curry2(function(r,t){var e=curryN(r,t);return curryN(r,function(){return _reduce(ap,map(e,arguments[0]),Array.prototype.slice.call(arguments,1))})}),lift=_curry1(function(r){return liftN(r.length,r)}),curry=_curry1(function(r){return curryN(r.length,r)}),call=curry(function(r){return r.apply(this,Array.prototype.slice.call(arguments,1))}),preservingReduced=function(r){return{"@@transducer/init":_xfBase.init,"@@transducer/result":function(t){return r["@@transducer/result"](t)},"@@transducer/step":function(t,e){var n=r["@@transducer/step"](t,e);return n["@@transducer/reduced"]?_forceReduced(n):n}}},_flatCat=function(r){var t=preservingReduced(r);return{"@@transducer/init":_xfBase.init,"@@transducer/result":function(r){return t["@@transducer/result"](r)},"@@transducer/step":function(r,e){return _isArrayLike(e)?_reduce(t,r,e):_reduce(t,r,[e])}}},_xchain=_curry2(function(r,t){return map(r,_flatCat(t))}),chain=_curry2(_dispatchable(["fantasy-land/chain","chain"],_xchain,function(r,t){return"function"==typeof t?function(e){return r(t(e))(e)}:_makeFlat(!1)(map(r,t))})),type=_curry1(function(r){return null===r?"Null":void 0===r?"Undefined":Object.prototype.toString.call(r).slice(8,-1)}),clone=_curry1(function(r){return null!=r&&"function"==typeof r.clone?r.clone():_clone(r,[],[],!0)}),not=_curry1(function(r){return!r}),complement=lift(not),slice=_curry3(_checkForMethod("slice",function(r,t,e){return Array.prototype.slice.call(e,r,t)})),tail=_curry1(_checkForMethod("tail",slice(1,1/0))),reverse=_curry1(function(r){return _isString(r)?r.split("").reverse().join(""):Array.prototype.slice.call(r,0).reverse()}),identical=_curry2(function(r,t){return r===t?0!==r||1/r==1/t:r!=r&&t!=t}),equals=_curry2(function(r,t){return _equals(r,t,[],[])}),pad=function(r){return(r<10?"0":"")+r},_toISOString="function"==typeof Date.prototype.toISOString?function(r){return r.toISOString()}:function(r){return r.getUTCFullYear()+"-"+pad(r.getUTCMonth()+1)+"-"+pad(r.getUTCDate())+"T"+pad(r.getUTCHours())+":"+pad(r.getUTCMinutes())+":"+pad(r.getUTCSeconds())+"."+(r.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},XFilter=function(){function r(r,t){this.xf=t,this.f=r}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=_xfBase.result,r.prototype["@@transducer/step"]=function(r,t){return this.f(t)?this.xf["@@transducer/step"](r,t):r},r}(),_xfilter=_curry2(function(r,t){return new XFilter(r,t)}),filter=_curry2(_dispatchable(["filter"],_xfilter,function(r,t){return _isObject(t)?_reduce(function(e,n){return r(t[n])&&(e[n]=t[n]),e},{},keys(t)):_filter(r,t)})),reject=_curry2(function(r,t){return filter(_complement(r),t)}),toString$1=_curry1(function(r){return _toString(r,[])}),converge=_curry2(function(r,t){return curryN(reduce(max,0,pluck("length",t)),function(){var e=arguments,n=this;return r.apply(n,_map(function(r){return r.apply(n,e)},t))})}),XReduceBy=function(){function r(r,t,e,n){this.valueFn=r,this.valueAcc=t,this.keyFn=e,this.xf=n,this.inputs={}}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=function(r){var t;for(t in this.inputs)if(_has(t,this.inputs)&&(r=this.xf["@@transducer/step"](r,this.inputs[t]))["@@transducer/reduced"]){r=r["@@transducer/value"];break}return this.inputs=null,this.xf["@@transducer/result"](r)},r.prototype["@@transducer/step"]=function(r,t){var e=this.keyFn(t);return this.inputs[e]=this.inputs[e]||[e,this.valueAcc],this.inputs[e][1]=this.valueFn(this.inputs[e][1],t),r},r}(),_xreduceBy=_curryN(4,[],function(r,t,e,n){return new XReduceBy(r,t,e,n)}),reduceBy=_curryN(4,[],_dispatchable([],_xreduceBy,function(r,t,e,n){return _reduce(function(n,u){var i=e(u);return n[i]=r(_has(i,n)?n[i]:t,u),n},{},n)})),countBy=reduceBy(function(r,t){return r+1},0),dec=add(-1),XDropRepeatsWith=function(){function r(r,t){this.xf=t,this.pred=r,this.lastValue=void 0,this.seenFirstValue=!1}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=_xfBase.result,r.prototype["@@transducer/step"]=function(r,t){var e=!1;return this.seenFirstValue?this.pred(this.lastValue,t)&&(e=!0):this.seenFirstValue=!0,this.lastValue=t,e?r:this.xf["@@transducer/step"](r,t)},r}(),_xdropRepeatsWith=_curry2(function(r,t){return new XDropRepeatsWith(r,t)}),nth=_curry2(function(r,t){var e=r<0?t.length+r:r;return _isString(t)?t.charAt(e):t[e]}),last=nth(-1),dropRepeatsWith=_curry2(_dispatchable([],_xdropRepeatsWith,function(r,t){var e=[],n=1,u=t.length;if(0!==u)for(e[0]=t[0];n<u;)r(last(e),t[n])||(e[e.length]=t[n]),n+=1;return e})),dropRepeats=_curry1(_dispatchable([],_xdropRepeatsWith(equals),dropRepeatsWith(equals))),flip=_curry1(function(r){return curryN(r.length,function(t,e){var n=Array.prototype.slice.call(arguments,0);return n[0]=e,n[1]=t,r.apply(this,n)})}),groupBy=_curry2(_checkForMethod("groupBy",reduceBy(function(r,t){return null==r&&(r=[]),r.push(t),r},null))),head=nth(0),identity=_curry1(_identity),inc=add(1),indexBy=reduceBy(function(r,t){return t},null),init=slice(0,-1),_Set=function(){function r(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return r.prototype.add=function(r){return!hasOrAdd(r,!0,this)},r.prototype.has=function(r){return hasOrAdd(r,!1,this)},r}(),uniqBy=_curry2(function(r,t){for(var e,n,u=new _Set,i=[],o=0;o<t.length;)e=r(n=t[o]),u.add(e)&&i.push(n),o+=1;return i}),uniq=uniqBy(identity),invoker=_curry2(function(r,t){return curryN(r+1,function(){var e=arguments[r];if(null!=e&&_isFunction(e[t]))return e[t].apply(e,Array.prototype.slice.call(arguments,0,r));throw new TypeError(toString$1(e)+' does not have a method named "'+t+'"')})}),join=invoker(1,"join"),juxt=_curry1(function(r){return converge(function(){return Array.prototype.slice.call(arguments,0)},r)}),sum=reduce(add,0),memoizeWith=_curry2(function(r,t){var e={};return _arity(t.length,function(){var n=r.apply(this,arguments);return _has(n,e)||(e[n]=t.apply(this,arguments)),e[n]})}),memoize=memoizeWith(function(){return toString$1(arguments)}),multiply=_curry2(function(r,t){return r*t}),partialRight=_createPartialApplicator(flip(_concat)),partition=juxt([filter,reject]),pickAll=_curry2(function(r,t){for(var e={},n=0,u=r.length;n<u;){var i=r[n];e[i]=t[i],n+=1}return e}),product=reduce(multiply,1),useWith=_curry2(function(r,t){return curryN(t.length,function(){for(var e=arguments,n=[],u=0;u<t.length;)n.push(t[u].call(this,e[u])),u+=1;return r.apply(this,n.concat(Array.prototype.slice.call(arguments,t.length)))})}),project=useWith(_map,[pickAll,identity]),range=_curry2(function(r,t){if(!_isNumber(r)||!_isNumber(t))throw new TypeError("Both arguments to range must be numbers");for(var e=[],n=r;n<t;)e.push(n),n+=1;return e}),split=invoker(1,"split"),toLower=invoker(0,"toLowerCase"),toPairs=_curry1(function(r){var t=[];for(var e in r)_has(e,r)&&(t[t.length]=[e,r[e]]);return t}),toUpper=invoker(0,"toUpperCase"),transduce=curryN(4,function(r,t,e,n){return _reduce(r("function"==typeof t?_xwrap(t):t),e,n)}),ws="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",zeroWidth="​",hasProtoTrim="function"==typeof String.prototype.trim,_trim=hasProtoTrim&&!ws.trim()&&zeroWidth.trim()?function(r){return r.trim()}:function(r){var t=new RegExp("^["+ws+"]["+ws+"]*"),e=new RegExp("["+ws+"]["+ws+"]*$");return r.replace(t,"").replace(e,"")},union=_curry2(compose(uniq,_concat)),unnest=chain(_identity),toString$3=Object.prototype.toString,isPlainObj=function(r){var t;return"[object Object]"===toString$3.call(r)&&(null===(t=Object.getPrototypeOf(r))||t===Object.getPrototypeOf({}))},commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},crossfilter$2=createCommonjsModule(function(r,t){!function(r){function t(r){return r}function e(r,t){for(var e=0,n=t.length,u=new Array(n);e<n;++e)u[e]=r[t[e]];return u}function n(r){function t(t,e,n,u){for(;n<u;){var i=n+u>>>1;e<r(t[i])?u=i:n=i+1}return n}return t.right=t,t.left=function(t,e,n,u){for(;n<u;){var i=n+u>>>1;r(t[i])<e?n=i+1:u=i}return n},t}function u(r){function t(r,t,n){for(var u=n-t,i=1+(u>>>1);--i>0;)e(r,i,u,t);return r}function e(t,e,n,u){for(var i,o=t[--u+e],a=r(o);(i=e<<1)<=n&&(i<n&&r(t[u+i])>r(t[u+i+1])&&i++,!(a<=r(t[u+i])));)t[u+e]=t[u+i],e=i;t[u+e]=o}return t.sort=function(r,t,n){for(var u,i=n-t;--i>0;)u=r[t],r[t]=r[t+i],r[t+i]=u,e(r,1,i,t);return r},t}function i(r){var t=u(r);return function(e,n,u,i){var o,a,c,l=new Array(i=Math.min(u-n,i));for(a=0;a<i;++a)l[a]=e[n++];if(t(l,0,i),n<u){o=r(l[0]);do{r(c=e[n])>o&&(l[0]=c,o=r(t(l,0,i)[0]))}while(++n<u)}return l}}function o(r){return function(t,e,n){for(var u=e+1;u<n;++u){for(var i=u,o=t[u],a=r(o);i>e&&r(t[i-1])>a;--i)t[i]=t[i-1];t[i]=o}return t}}function a(r){function t(n,u,i){return(i-u<b?e:function(e,n,u){var i,o=(u-n)/6|0,a=n+o,c=u-1-o,l=n+u-1>>1,s=l-o,f=l+o,p=e[a],d=r(p),y=e[s],h=r(y),_=e[l],g=r(_),v=e[f],m=r(v),b=e[c],A=r(b);d>h&&(i=p,p=y,y=i,i=d,d=h,h=i);m>A&&(i=v,v=b,b=i,i=m,m=A,A=i);d>g&&(i=p,p=_,_=i,i=d,d=g,g=i);h>g&&(i=y,y=_,_=i,i=h,h=g,g=i);d>m&&(i=p,p=v,v=i,i=d,d=m,m=i);g>m&&(i=_,_=v,v=i,i=g,g=m,m=i);h>A&&(i=y,y=b,b=i,i=h,h=A,A=i);h>g&&(i=y,y=_,_=i,i=h,h=g,g=i);m>A&&(i=v,v=b,b=i,i=m,m=A,A=i);var S=y,x=h,w=v,O=m;e[a]=p,e[s]=e[n],e[l]=_,e[f]=e[u-1],e[c]=b;var k=n+1,D=u-2,E=x<=O&&x>=O;if(E)for(P=k;P<=D;++P){C=e[P];if((N=r(C))<x)P!==k&&(e[P]=e[k],e[k]=C),++k;else if(N>x)for(;;){if(!((F=r(e[D]))>x)){if(F<x){e[P]=e[k],e[k++]=e[D],e[D--]=C;break}e[P]=e[D],e[D--]=C;break}D--}}else for(P=k;P<=D;P++){C=e[P];if((N=r(C))<x)P!==k&&(e[P]=e[k],e[k]=C),++k;else if(N>O)for(;;){if(!((F=r(e[D]))>O)){F<x?(e[P]=e[k],e[k++]=e[D],e[D--]=C):(e[P]=e[D],e[D--]=C);break}if(--D<P)break}}if(e[n]=e[k-1],e[k-1]=S,e[u-1]=e[D+1],e[D+1]=w,t(e,n,k-1),t(e,D+2,u),E)return e;if(k<a&&D>c){for(var j;(j=r(e[k]))<=x&&j>=x;)++k;for(;(F=r(e[D]))<=O&&F>=O;)--D;for(var P=k;P<=D;P++){var C=e[P],N=r(C);if(N<=x&&N>=x)P!==k&&(e[P]=e[k],e[k]=C),k++;else if(N<=O&&N>=O)for(;;){var F;if(!((F=r(e[D]))<=O&&F>=O)){F<x?(e[P]=e[k],e[k++]=e[D],e[D--]=C):(e[P]=e[D],e[D--]=C);break}if(--D<P)break}}}return t(e,k,D+1)})(n,u,i)}var e=o(r);return t}function c(r){for(var t=new Array(r),e=-1;++e<r;)t[e]=0;return t}function l(r){return[0,r.length]}function s(){return null}function f(){return 0}function p(r){return r+1}function d(r){return r-1}function y(r){return function(t,e){return t+ +r(e)}}function h(r){return function(t,e){return t-r(e)}}function _(){function r(r){var t=c,e=r.length;return e&&(o=o.concat(r),S=w(S,c+=e),k.forEach(function(n){n(r,t,e)})),n}var n={add:r,remove:function(){for(var r=g(c,c),t=[],e=0,n=0;e<c;++e)S[e]?r[e]=n++:t.push(e);x.forEach(function(r){r(0,[],t)}),D.forEach(function(t){t(r)});for(var u,e=0,n=0;e<c;++e)(u=S[e])&&(e!==n&&(S[n]=u,o[n]=o[e]),++n);for(o.length=n;c>n;)S[--c]=0},dimension:function(r){function n(t,n,u){M=t.map(r),L=H(function(r){for(var t=g(r,r),e=-1;++e<r;)t[e]=e;return t}(u),0,u),M=e(M,L);var i,o=$(M),a=o[0],l=o[1];if(W)for(i=0;i<u;++i)W(M[i],i)||(S[L[i]+n]|=z);else{for(i=0;i<a;++i)S[L[i]+n]|=z;for(i=l;i<u;++i)S[L[i]+n]|=z}if(!n)return q=M,R=L,K=a,void(Y=l);var s=q,f=R,p=0,d=0;for(q=new Array(c),R=g(c,c),i=0;p<n&&d<u;++i)s[p]<M[d]?(q[i]=s[p],R[i]=f[p++]):(q[i]=M[d],R[i]=L[d++]+n);for(;p<n;++p,++i)q[i]=s[p],R[i]=f[p];for(;d<u;++d,++i)q[i]=M[d],R[i]=L[d]+n;o=$(q),K=o[0],Y=o[1]}function A(r,t,e){V.forEach(function(r){r(M,L,t,e)}),M=L=null}function E(r){for(var t,e=0,n=0;e<c;++e)S[t=R[e]]&&(e!==n&&(q[n]=q[e]),R[n]=r[t],++n);for(q.length=n;n<c;)R[n++]=0;var u=$(q);K=u[0],Y=u[1]}function j(r){var t=r[0],e=r[1];if(W)return W=null,T(function(r,n){return t<=n&&n<e}),K=t,Y=e,U;var n,u,i,o=[],a=[];if(t<K)for(n=t,u=Math.min(K,e);n<u;++n)S[i=R[n]]^=z,o.push(i);else if(t>K)for(n=K,u=Math.min(t,Y);n<u;++n)S[i=R[n]]^=z,a.push(i);if(e>Y)for(n=Math.max(t,Y),u=e;n<u;++n)S[i=R[n]]^=z,o.push(i);else if(e<Y)for(n=Math.max(K,e),u=Y;n<u;++n)S[i=R[n]]^=z,a.push(i);return K=t,Y=e,x.forEach(function(r){r(z,o,a)}),U}function P(r){return j(($=function(r,t){return function(e){var n=e.length;return[r.left(e,t,0,n),r.right(e,t,0,n)]}}(m,r))(q))}function C(r){return j(($=function(r,t){var e=t[0],n=t[1];return function(t){var u=t.length;return[r.left(t,e,0,u),r.left(t,n,0,u)]}}(m,r))(q))}function N(){return j(($=l)(q))}function F(r){return $=l,T(W=r),K=0,Y=c,U}function T(r){var t,e,n,u=[],i=[];for(t=0;t<c;++t)!(S[e=R[t]]&z)^!!(n=r(q[t],t))&&(n?(S[e]&=X,u.push(e)):(S[e]|=z,i.push(e)));x.forEach(function(r){r(z,u,i)})}function B(r){function e(t,e,n,u){function i(){++U===W&&(k=O(k,L<<=1),N=O(N,L),W=v(L))}var f,p,d,y,h,b,A=C,k=g(U,W),D=B,E=M,j=U,P=0,F=0;for(K&&(D=E=s),C=new Array(U),U=0,N=j>1?w(N,c):g(c,W),j&&(d=(p=A[0]).key);F<u&&!((y=r(t[F]))>=y);)++F;for(;F<u;){for(p&&d<=y?(h=p,b=d,k[P]=U,(p=A[++P])&&(d=p.key)):(h={key:y,value:E()},b=y),C[U]=h;!(y>b||(N[f=e[F]+n]=U,S[f]&X||(h.value=D(h.value,o[f])),++F>=u));)y=r(t[F]);i()}for(;P<j;)C[k[P]=U]=A[P++],i();if(U>P)for(P=0;P<n;++P)N[P]=k[N[P]];f=x.indexOf(H),U>1?(H=a,$=_):(!U&&Y&&(U=1,C=[{key:null,value:E()}]),1===U?(H=l,$=m):(H=s,$=s),N=null),x[f]=H}function n(){if(U>1){for(var r=U,t=C,e=g(r,r),n=0,u=0;n<c;++n)S[n]&&(e[N[u]=N[n]]=1,++u);for(C=[],U=0,n=0;n<r;++n)e[n]&&(e[n]=U++,C.push(t[n]));if(U>1)for(n=0;n<u;++n)N[n]=e[N[n]];else N=null;x[x.indexOf(H)]=U>1?($=_,H=a):1===U?($=m,H=l):$=H=s}else if(1===U){if(Y)return;for(n=0;n<c;++n)if(S[n])return;C=[],U=0,x[x.indexOf(H)]=H=$=s}}function a(r,t,e){if(r!==z&&!K){var n,u,i,a;for(n=0,i=t.length;n<i;++n)S[u=t[n]]&X||((a=C[N[u]]).value=B(a.value,o[u]));for(n=0,i=e.length;n<i;++n)(S[u=e[n]]&X)===r&&((a=C[N[u]]).value=I(a.value,o[u]))}}function l(r,t,e){if(r!==z&&!K){var n,u,i,a=C[0];for(n=0,i=t.length;n<i;++n)S[u=t[n]]&X||(a.value=B(a.value,o[u]));for(n=0,i=e.length;n<i;++n)(S[u=e[n]]&X)===r&&(a.value=I(a.value,o[u]))}}function _(){var r,t;for(r=0;r<U;++r)C[r].value=M();for(r=0;r<c;++r)S[r]&X||((t=C[N[r]]).value=B(t.value,o[r]))}function m(){var r,t=C[0];for(t.value=M(),r=0;r<c;++r)S[r]&X||(t.value=B(t.value,o[r]))}function b(){return K&&($(),K=!1),C}function A(r,t,e){return B=r,I=t,M=e,K=!0,P}function k(){return A(p,d,f)}function E(r){function t(t){return r(t.value)}return F=i(t),T=u(t),P}function j(){var r=x.indexOf(H);return r>=0&&x.splice(r,1),(r=V.indexOf(e))>=0&&V.splice(r,1),(r=D.indexOf(n))>=0&&D.splice(r,1),P}var P={top:function(r){var t=F(b(),0,C.length,r);return T.sort(t,0,t.length)},all:b,reduce:A,reduceCount:k,reduceSum:function(r){return A(y(r),h(r),f)},order:E,orderNatural:function(){return E(t)},size:function(){return U},dispose:j,remove:j};G.push(P);var C,N,F,T,B,I,M,L=8,W=v(L),U=0,H=s,$=s,K=!0,Y=r===s;return arguments.length<1&&(r=t),x.push(H),V.push(e),D.push(n),e(q,R,0,c),k().orderNatural()}function I(){G.forEach(function(r){r.dispose()});var r=k.indexOf(n);return r>=0&&k.splice(r,1),(r=k.indexOf(A))>=0&&k.splice(r,1),(r=D.indexOf(E))>=0&&D.splice(r,1),_&=X,N()}var q,R,M,L,W,U={filter:function(r){return null==r?N():Array.isArray(r)?C(r):"function"==typeof r?F(r):P(r)},filterExact:P,filterRange:C,filterFunction:F,filterAll:N,top:function(r){for(var t,e=[],n=Y;--n>=K&&r>0;)S[t=R[n]]||(e.push(o[t]),--r);return e},bottom:function(r){for(var t,e=[],n=K;n<Y&&r>0;)S[t=R[n]]||(e.push(o[t]),--r),n++;return e},group:B,groupAll:function(){var r=B(s),t=r.all;return delete r.all,delete r.top,delete r.order,delete r.orderNatural,delete r.size,r.value=function(){return t()[0].value},r},dispose:I,remove:I},z=~_&-~_,X=~z,H=a(function(r){return M[r]}),$=l,V=[],G=[],K=0,Y=0;return k.unshift(n),k.push(A),D.push(E),_|=z,(b>=32?!z:_&-(1<<b))&&(S=O(S,b<<=1)),n(o,0,c),A(0,0,c),U},groupAll:function(){function r(r,t){var e;if(!g)for(e=t;e<c;++e)S[e]||(i=a(i,o[e]))}function t(r,t,e){var n,u,c;if(!g){for(n=0,c=t.length;n<c;++n)S[u=t[n]]||(i=a(i,o[u]));for(n=0,c=e.length;n<c;++n)S[u=e[n]]===r&&(i=l(i,o[u]))}}function e(r,t,e){return a=r,l=t,s=e,g=!0,_}function n(){return e(p,d,f)}function u(){var e=x.indexOf(t);return e>=0&&x.splice(e),(e=k.indexOf(r))>=0&&k.splice(e),_}var i,a,l,s,_={reduce:e,reduceCount:n,reduceSum:function(r){return e(y(r),h(r),f)},value:function(){return g&&(function(){var r;for(i=s(),r=0;r<c;++r)S[r]||(i=a(i,o[r]))}(),g=!1),i},dispose:u,remove:u},g=!0;return x.push(t),k.push(r),r(0,0),n()},size:function(){return c}},o=[],c=0,_=0,b=8,S=A(0),x=[],k=[],D=[];return arguments.length?r(arguments[0]):n}function g(r,t){return(t<257?A:t<65537?S:x)(r)}function v(r){return 8===r?256:16===r?65536:4294967296}_.version="1.3.12",_.permute=e;var m=_.bisect=n(t);m.by=n;(_.heap=u(t)).by=u;(_.heapselect=i(t)).by=i;(_.insertionsort=o(t)).by=o;(_.quicksort=a(t)).by=a;var b=32,A=c,S=c,x=c,w=function(r,t){for(var e=r.length;e<t;)r[e++]=0;return r},O=function(r,t){if(t>32)throw new Error("invalid array width!");return r};"undefined"!=typeof Uint8Array&&(A=function(r){return new Uint8Array(r)},S=function(r){return new Uint16Array(r)},x=function(r){return new Uint32Array(r)},w=function(r,t){if(r.length>=t)return r;var e=new r.constructor(t);return e.set(r),e},O=function(r,t){var e;switch(t){case 16:e=S(r.length);break;case 32:e=x(r.length);break;default:throw new Error("invalid array width!")}return e.set(r),e}),r.crossfilter=_}(t||commonjsGlobal)}),crossfilter=crossfilter$2.crossfilter,fastIsnumeric=function(r){var t=typeof r;if("string"===t){var e=r;if(0===(r=+r)&&allBlankCharCodes(e))return!1}else if("number"!==t)return!1;return r-r<1},cf=crossfilter,CROSSFILTER_WHITELISTED_PLOTS=["bar","box","choropleth","histogram","pie","scatter","scatter3d","scattergeo","scattermapbox","table"],DESELECTDIM=.1,DESELECTDIM_MAPBOX=.01,srcFieldSuffix="src",keepColumnId=/[^:]+(?=[^:]*$)/,gridSourceAttribute=function(r){return"src"===r.slice(-srcFieldSuffix.length)},getBaseAttributeName=function(r){return r.slice(0,-srcFieldSuffix.length)},getPlotArray=function(r){return[].slice.call(r.querySelectorAll(".js-plotly-plot"))},collectFieldSourcesInTrace=function(r,t,e){return walkObject(t,function(n,u,i){var o=r._crossfilter;if(!("table"===t.type&&"header"===i[0])&&gridSourceAttribute(n)){var a=u[n].match(keepColumnId)[0],c=n,l=getBaseAttributeName(c),s=[];if("table"===t.type&&"cells"===i[0]){a.replace(/\*/g,"").split(",").forEach(function(t,n){var o=i.concat([l,n]);s.push({gd:r,srcFieldName:c,traceIndex:e,data:u[l][n],pathArray:o,fieldPath:makeAttrSetterPath(o),constrained:!1,gridColumnName:t})})}else s.push({gd:r,srcFieldName:c,traceIndex:e,data:u[l],pathArray:i.concat([l]),fieldPath:makeAttrSetterPath(i.concat([l])),constrained:!1,gridColumnName:a});s.forEach(function(r){o.fieldSources[r.gridColumnName]=(o.fieldSources[r.gridColumnName]||[]).concat(r)})}},{walkArraysMatchingKeys:["transforms"]})},eventPointsToDataPoints=function(r,t){for(var e={},n=0;n<t.length;n++){var u=t[n],i=u.fullData&&u.fullData.transforms,o=i?i.filter(function(r){return r._indexToPoints}):[];if(o.length){o[o.length-1]._indexToPoints[u.pointNumber].forEach(function(r){e[r]={pointNumber:r}})}else if("pie"===r._fullData[0].type)for(var a=0;a<r.data[0].labels.length;a++)r.data[0].labels[a]===u.label&&(e[a]={pointNumber:a});else e[u.pointNumber]=u}return e},isDashboardCompliantForCrossfilter=function(r){var t=r.every(function(r){return-1!==CROSSFILTER_WHITELISTED_PLOTS.indexOf(r.type)}),e={};r.forEach(function(r){return Object.keys(r).filter(gridSourceAttribute).forEach(function(t){var n=r[getBaseAttributeName(t)].length;e[n]=!0})});var n=Object.keys(e).length<2,u=!1;return r.some(function(r){return walkObject(r,function(r){gridSourceAttribute(r)&&(u=!0)},{walkArraysMatchingKeys:["transforms"]})}),t&&u&&n},setDeepProp=function(r,t,e){for(var n=0,u=r;n<t.length;n++){var i=t[n],o=void 0!==u[i];n===t.length-1?u[i]=e:o||(u[i]={}),u=u[i]}},gridBackedAttribute=function(r){return"src"===r.slice(-srcFieldSuffix.length)},eraseGridPropsFromTrace=function(r){return walkObject(r,function(r,t,e){gridBackedAttribute(r)&&"header"!==e[0]&&(t[getBaseAttributeName(r)]=[])},{walkArraysMatchingKeys:["transforms"]})},cfEnabled=function(r,t){return r&&isDashboardCompliantForCrossfilter(t.data)},cfLayoutOverrides={dragmode:"select",showlegend:!1},getCrossfilter=function(r){return r.length?r[0]._crossfilter:{fieldSources:{},cf:null,grid:{}}},persistCrossfilter=function(r,t){r._crossfilter=t},restylePlots=function(r,t,e){var n=t.plotDimensions.concat(t.formDimensions).some(function(r){return r.constrained}),u=n?t.recordDimension.top(1/0).sort(function(r,t){return r.index-t.index}):[];e.filter(function(r){return r.includedInCrossfilter}).forEach(function(e){var i=e._cfData.originalData.map(clone);i.forEach(eraseGridPropsFromTrace);[].concat.apply([],values(t.fieldSources)).filter(function(r){return r.gd===e}).forEach(function(r){var t=u.map(function(t){return t[r.gridColumnName]});i.forEach(function(n,u){if(u===r.traceIndex){setDeepProp(n,r.pathArray,t);var i=e._fullData[u].marker||{},o=Array.isArray(i.color),a=!o||o&&!fastIsnumeric(i.color[0]);"pie"!==n.type&&e._fullData[u].marker&&a&&(n.marker=n.marker||{},n.marker.color=e._fullData[u].marker.color)}})}),r.deleteTraces(e,range(e._cfData.originalData.length,e.data.length)),n&&e._fullData.length===e._cfData.originalData.length&&r.addTraces(e,i),i.forEach(function(t,u){return dimTracePostStyle(r,e,n,t,u)})})},resetAllFilters=function(r){return r.plotDimensions.concat(r.formDimensions).forEach(function(r){r.constrained=!1,r.cfDimension&&r.cfDimension.filter(null)})},resetCrossfilter=function(r){var t=getPlotArray(document),e=t[0]._crossfilter;resetAllFilters(e),restylePlots(r,e,[].concat(t).filter(function(r){return r.includedInCrossfilter}))},specFilter=function(r,t){var e=getPlotArray(document),n=t.gridColumn,u=t.isNaN?t.value:Number(t.value),i=t.operator,o=e[0]._crossfilter,a=o.formDimensions[0];a.constrained=!0,a.cfDimension&&(a.cfDimension.filter(null),a.cfDimension.dispose(),a.cfDimension=null,a.constrained=!1),a.cfDimension=o.cf.dimension(function(r){return r[n]});var c={">":function(r){return r>u},"<":function(r){return r<u},"==":function(r){return r===u}}[i];a.cfDimension.filterFunction(c),a.constrained=!0,restylePlots(r,o,[].concat(e).filter(function(r){return r.includedInCrossfilter}))},selectionHandler=function(r,t,e){var n=t._crossfilter,u=n.plotDimensions.find(function(r){return r.gd===t}),i=getEventPoints(t,u,e);resetAllFilters(n);var o=eventPointsToDataPoints(t,i);u.constrained=i.length>0,u.constrained||t.querySelectorAll(".select-outline").forEach(function(r){return r.parentNode.removeChild(r)}),u.cfDimension.filterFunction(u.constrained?function(r){return o[r]}:function(){return!0}),r.restyle(t,"selectedpoints",null),restylePlots(r,n,getPlotArray(document).filter(function(r){return r.includedInCrossfilter}))},cfPlotSetup=function(r,t,e,n,u){var i=getCrossfilter(t);persistCrossfilter(n,i),u.data.forEach(function(r,t){return collectFieldSourcesInTrace(n,r,t)}),Object.keys(i.fieldSources).forEach(function(r){var t=i.fieldSources[r];i.grid[r]=t[0].data}),i.cf=cf(),e.then(function(t){"pie"===t._fullData[0].type?t.on("plotly_click",selectionHandler.bind(0,r,t)):t.on("plotly_selected",selectionHandler.bind(0,r,t)),t.includedInCrossfilter=!0,i.plotDimensions&&i.plotDimensions.length&&i.plotDimensions.forEach(function(r){return r.cfDimension.dispose()}),i.plotDimensions=getPlotArray(document).filter(function(r){return r.includedInCrossfilter}).map(function(r){return{gd:r,constrained:!1,cfDimension:i.cf.dimension(function(r){return r.index})}}),i.formDimensions=[{gd:void 0,constrained:!1,cfDimension:null}],n._cfData={originalData:n.data.map(clone),originalFullData:n._fullData.map(clone),originalOpacity:map(function(r){return r.style.opacity})(n.querySelectorAll(".trace"))}}),i.recordDimension=i.cf.dimension(function(r){return r});var o=toPairs(i.grid);if(o.length){var a=o[0][1].map(function(r,t){for(var e={},n=0;n<o.length;n++)e.index=t,e[o[n][0]]=o[n][1][t];return e});i.cf.add(a)}};exports.cfEnabled=cfEnabled,exports.cfLayoutOverrides=cfLayoutOverrides,exports.resetCrossfilter=resetCrossfilter,exports.specFilter=specFilter,exports.cfPlotSetup=cfPlotSetup;
